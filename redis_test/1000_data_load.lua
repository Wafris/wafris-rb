

-- Template strings below are replaced with generated 
-- data from the ip_data_generator.rb script

local ipArray = {2813705061,1139417839,360810941,3233546744,3596482970,1785801198,3044455514,296891580,1217236074,3536136055,775486106,238485669,348238345,4070188747,2628347848,3220924132,1642929990,2521808348,1646272633,2254688800,1822471278,4043406282,4078281967,2023383348,1459074916,1541871024,2163793709,84942750,52277617,1230417550,294397452,1605603344,971320258,430517519,3188899697,2178413324,868558053,1476678463,3681810346,3252336888,2566034710,155010960,2995455423,917925121,2573507519,377620092,2806670131,2401972261,1531502963,2787797145,3243541916,458786602,2042087897,2410830042,207992848,3567258023,496840694,2138549373,976950681,2001472982,1700279197,1131336268,4289901447,3248373305,3653115330,3431295938,1791017625,1487243289,1811937656,3399061047,259904451,3200385912,3882888380,1365745396,715772736,2085205303,360093864,409408447,4042358886,4015421130,217068768,3895549566,1263807368,2019719866,2996124180,3055688287,4163239722,4019587481,2104813536,599574414,2298338929,2553221126,978628817,4278394036,3003367904,405338069,2105391610,2887839651,1372503969,2763510051,1054656748,1098409348,160851761,348291053,3379618248,3334446980,3897496871,3950319272,210533525,3948399007,986790193,1551160730,3351353552,1667294991,3081298094,793668586,1003147680,4290734735,3818092138,1882366218,1112290595,4117775288,2421324439,2475255268,3171069799,2147222779,4075328126,75372484,3306712826,2557857610,2746176975,304092168,2296563339,511741856,2517810253,2186645720,3177754934,1703181110,310688621,695784130,1408900782,2331421781,3414833763,3322951373,1016844167,1798214869,2344554165,390580950,3697008052,1597687074,939468965,291248909,635078257,872120612,2512650160,2169942374,2278485700,2550521316,3756177915,636811843,1144960491,4171868928,3008038907,874071775,2714163795,3660697385,1556978416,4118889398,2343599647,2102641158,1798572768,3820552308,2467428470,3641624110,2230819620,3988544853,1342641298,184082029,3788307241,3960729054,1177347938,2219724586,3634701279,2189196856,2790224844,1688411720,1580218023,3411339458,3352838164,216946979,3677258185,1209185828,630055725,138439658,3443008987,4270484077,1620710290,3732416739,337622628,3982928305,3259674942,2467436553,1469115410,4124506055,4473281,3454470363,399027113,2905249653,593310394,2550022190,864002995,944970401,612102675,1887785958,255086188,3419249370,1187556874,121733034,4194622885,730759669,2370582552,2689192497,3346555534,2872813742,687544136,2658929616,2462492058,451991423,3404215880,3086175852,1696865935,2385055634,220680352,3877059831,382632846,1518754680,3549237419,2241143315,3655856379,2532506635,435034820,2239958485,606335075,683396788,2217586512,4264168901,2001731775,4121465461,3907067136,3650640158,1749003824,4027081351,2205770891,4175383957,3357735653,3266335129,2849650628,1402391660,1849385361,707956152,1971052642,426498593,4196012530,1565834334,2749003812,1005121748,1284305119,223702326,811329938,1231903256,628701385,1524698861,412642514,4017264601,964159332,652625417,3969107089,3279161897,464797398,3203286575,2933546052,199906491,2330003523,167053467,1187782769,749042468,3224359206,3422043265,1692446191,289575360,1209774661,1175256569,3241327197,2694993544,531738783,3588026588,3604672946,1451477440,1750092063,1230914401,4266080858,1660870298,2723750443,3136129050,932930932,2338113343,1673475227,447757023,1423481627,3273772945,3619648953,783560083,4180533129,3710234406,57074252,3367466863,1752247317,3822053012,1942474555,2628138408,194227753,4269467101,1913783093,2768456491,2733517500,2773309050,2810323247,353243475,2339124424,1103333404,234896761,992829442,2241056785,2353307805,12815034,4001822008,1325304096,2352490038,3335619350,3776367457,2849506431,3952079088,1977460776,2698395557,922165008,2131534358,505264073,2232393987,3758264946,3557404671,3933177501,620876229,3898816476,3275081065,578814508,4102512342,1948835504,2495683206,3860365198,1987093732,3989962575,3263891199,340241152,1248907496,3409622852,2434366429,2586928281,1704013215,29927308,4023583346,4033814500,3889375321,3201873324,1866067869,1045855318,1030731557,86675513,839095071,3509689683,3308527850,3638121270,577932331,3720077837,2804950504,105706080,3311519060,2376059894,3929740664,4090983905,1945401732,929434069,714331938,2063043613,3735839183,3286821731,460405447,3583213933,1318991688,1013173336,1666416713,2275421196,3498856759,754107492,3254221277,2525574972,3278920526,799965794,947044063,1193652448,3223970794,3406377106,2227440621,2658037595,3351182337,1764863478,3137513742,460956804,480774562,3449312125,693613790,458177025,1023663786,3384793594,3971554770,3048006274,2893701737,1508124610,1483687334,562460380,4047713877,2048124429,1094970884,157474744,1082212460,2913524840,219236714,2877635164,3886082789,1145452106,1472234551,666590106,2042897632,3703177361,1693204744,1125512923,461997863,2849495061,600434783,1102587661,2965256124,2736655189,3810941803,1151881944,272591338,780368783,3862073463,1624413651,3421302479,3615309115,3817677175,2360504649,2249205665,4089095144,1892135588,2937704602,942774008,1634741746,3827268607,250609111,3318057596,4153548671,3699434125,2159087753,2930121970,2155222582,2237507195,2383172067,1891928870,3490747912,3332704400,3842114439,3105093832,2665940578,2847421417,1657945633,2360792814,2148215568,3762016523,3123239091,1683246736,3003705917,2455127478,1536231957,1952223955,1548546175,361186616,3377079209,2844104232,3034444586,949622770,2754780935,4084803695,1866548675,576535735,2484427375,1252106591,3787387713,2030387026,377551010,3947673072,3321754163,241409387,3804267106,2879751783,1952358264,3761696689,1354009648,3636407958,2709345033,3993602595,2318841403,140016845,3707646285,1598805631,2136628384,4013786620,217790524,171438295,696209096,894968602,2039755357,4041203879,1187177739,1793935873,3866690880,4247334680,1365594042,877562378,2358492400,3780955943,4263760143,789332269,2372709783,2791658486,341421852,3494651466,524136171,3284737106,2193712074,2992958290,1352101612,3556120223,1594710678,1911414507,1696967572,1667593096,1337280753,3035147898,3126695864,937980453,3520746188,904268075,1224759225,4176349316,985618340,2450803697,2627932664,2400045456,1669491699,2505880492,4097962049,414405814,2784202001,1090458462,550968810,2977943525,1217982032,183214711,2750161901,3720507812,3159799028,3348285485,673305667,2206723002,2826854967,2542058814,1873220311,4007275031,3415557958,2939194931,3281253913,2415763253,417631747,2330350863,1771969971,2426415935,1412654823,1671787227,2111279958,2527630308,2731388755,993361883,4020366493,1164594659,841014696,4281451134,4091342560,1509192865,3971365127,2164875353,2849100561,1497685720,2634815862,3890389274,868936231,2550342056,934515240,2208761804,3514634386,3935767271,1706029593,4087294299,2873647381,589183533,3973145013,499853938,986066122,4019243583,3848955503,169792600,1999113813,1893506586,1563392137,2196769804,3549984880,3040455429,832821912,3810504184,2602604209,2562359492,127724804,558342666,2917727253,579829258,3108696430,3337495509,2901730976,4024985808,3186245163,3008321180,1899962132,4086233106,2135806541,4081430884,806819312,155805361,264837573,2474804282,823601421,2480541136,4054723703,2136119433,171611989,860892761,2243503665,1445439487,3271169363,2872576552,2760542667,2214366349,949351840,3784541536,666890494,993730148,3823130727,1743061802,3732507871,2844375617,1276454694,927139488,2198898954,1179339580,1214102497,1211157916,4240801214,1113590297,2948517485,3887761576,3162895195,1710295502,4191070923,150215933,2115420578,1119682656,1451958804,1525112564,93381390,1543531081,1542254556,1527360057,4012445101,2549177694,61304268,2319885702,1148795266,2105045077,934168401,3207011298,2882323424,1647460398,4182609880,4149399393,555183753,1508352954,612584799,4030116697,1276264387,2716604206,1005185792,1447719441,2290667846,3721842780,262049613,2258260618,3803687945,3576662039,1548652223,3718179941,1056812877,2078434518,888559238,4203410868,712940532,3600347932,3928235159,3799371806,1932685943,4041110853,2901627394,2755490469,3540146662,4179962317,2498867073,1726382430,2809678358,2887973419,881074716,3611460781,2143483442,2436062772,2966059545,1095519184,4278964060,1040611393,1435897432,929794759,1791434853,952681168,1240902695,625644457,81624711,1731665953,1086978679,514561059,1707480939,308816620,2360747171,279136727,1819116500,1433131060,893316106,1605127921,2682361739,2038795340,3889330545,2171433640,3260515346,3793337195,3412082712,3238183550,3112486296,2119251958,1668272521,681019816,202227532,1383080060,3203172027,2265213981,1030979545,4167658477,2654406086,2563689953,3569832987,1803894136,3790191260,4084966475,1748991804,2289149357,2939608095,4245821435,1647453968,3231754511,2685262952,539474539,2161259869,730592493,2712266586,2508045151,922359668,4019760687,2740762558,2001001015,2361743161,52333904,3371415064,2927101618,3777442418,2208356712,1348378452,2094756079,151940872,502194355,3098894727,294626385,3461470102,4048775227,691360208,2169576563,2237590962,1799187094,952044804,273645667,556882686,3653040857,929816162,616693153,4243583758,2694581642,2832760707,837033494,3193852380,3100935338,1384840907,3007166111,2499585957,3217684797,2789006632,618965700,2944205071,731719262,3569313495,2619521773,2604912772,1400595075,2194654838,2913966037,3518973227,3399155559,1081251866,1579921696,4056430384,2056742593,3333128654,2234014564,3501569795,1595671353,3235194652,2716308744,399284976,412903736,2471192900,3924225600,4222609818,1554093179,1114407545,1230151594,4273220380,2291394350,619631044,4029529798,3050092719,2682244247,3280379421,3471226088,1207229493,3496808137,2099667941,2016914508,3569498899,3031789933,3324848722,2159873052,1597474674,3668277755,321899805,2129766262,1517254915,2617844845,386747587,3306887112,248007431,3568053348,2016216822,386831592,1068084494,951204100,4089581068,3992574158,4225928239,4105916155,2245359103,2267524290,3293557878,4096497869,2862017215,2068817075,3244388783,1909371549,2512799242,2755115116,377965112,1961427097,731045590,712848169,2710237955,2556777196,1663903972,1910000536,3083754001,4099020774,1531508907,3289250726,825200218,684247717,2946957045,1415843090,3582333128,562165394,3701053749,1554791045,1777798169,227897834,965363811,985981835,2978643252,1436560049,2440843832,1756311414,2436050928,4250006505,3683357252,107750717,2827201490,1520746756,3130029616,1002041137,643884002,3071825948,898624411,3072933568,4276701554,84944487,2473754526,3744438137,2706527376,675984773,3641626260,3719515539,2778084847,2540611207,1777352337,201410470,3908640209,1899033419,2081053269,3740362000,3374678605,2324839324,2217082411,2740517308,2031769322,1304429517,790344425,1195228572,4240714864,3948481236,3126364662,1991500528,447935906,3491644824,2303521877,372351795,2876308485,1269873098,4160552090,2192228231,1909504546,715652064,729354394,3679388234}
local timestampArray = {1677979257,1677979310,1677979387,1677979392,1677979396,1677979492,1677979515,1677979748,1677979779,1677979789,1677979919,1677980009,1677980190,1677980300,1677980543,1677980642,1677980689,1677980725,1677980777,1677981092,1677981114,1677981209,1677981269,1677981303,1677981444,1677981501,1677981618,1677981652,1677981660,1677981739,1677981782,1677981831,1677982167,1677982331,1677982362,1677982485,1677982555,1677982693,1677982732,1677982792,1677982802,1677982844,1677983033,1677983195,1677983228,1677983256,1677983705,1677983822,1677983859,1677983934,1677983981,1677984156,1677984187,1677984399,1677984439,1677984569,1677984616,1677984655,1677984661,1677984668,1677984952,1677984960,1677985031,1677985068,1677985246,1677985249,1677985279,1677985328,1677985330,1677985351,1677985475,1677985482,1677985483,1677985565,1677985600,1677985636,1677985677,1677985735,1677985740,1677985765,1677985818,1677985863,1677985886,1677986009,1677986057,1677986132,1677986160,1677986192,1677986251,1677986362,1677986408,1677986493,1677986711,1677986825,1677986870,1677986900,1677986962,1677986970,1677987061,1677987110,1677987488,1677987532,1677987901,1677988017,1677988030,1677988059,1677988160,1677988230,1677988256,1677988261,1677988401,1677988460,1677988466,1677988467,1677988632,1677988635,1677988746,1677988918,1677988919,1677988927,1677988988,1677989311,1677989322,1677989328,1677989413,1677989428,1677989441,1677989481,1677989500,1677989630,1677989633,1677989795,1677989888,1677989948,1677989997,1677990046,1677990078,1677990150,1677990223,1677990295,1677990324,1677990352,1677990398,1677990432,1677990459,1677990556,1677990721,1677990770,1677990837,1677990843,1677990958,1677991007,1677991246,1677991248,1677991345,1677991506,1677991584,1677991597,1677991626,1677991670,1677991694,1677991820,1677991849,1677991862,1677991913,1677991984,1677992166,1677992243,1677992252,1677992368,1677992556,1677992761,1677992776,1677992818,1677993071,1677993185,1677993250,1677993283,1677993291,1677993355,1677993455,1677993718,1677993834,1677993838,1677994311,1677994334,1677994374,1677994400,1677994434,1677994470,1677994484,1677994496,1677994522,1677994620,1677994697,1677994776,1677995234,1677995431,1677995512,1677995516,1677995522,1677995725,1677996079,1677996102,1677996123,1677996134,1677996159,1677996262,1677996263,1677996267,1677996284,1677996323,1677996376,1677996392,1677996396,1677996506,1677996517,1677996593,1677996598,1677996810,1677996830,1677996994,1677997014,1677997020,1677997099,1677997155,1677997192,1677997257,1677997345,1677997373,1677997469,1677997604,1677997616,1677997701,1677997811,1677997898,1677997919,1677998201,1677998209,1677998242,1677998431,1677998604,1677998674,1677998785,1677998814,1677999022,1677999121,1677999126,1677999210,1677999233,1677999245,1677999285,1677999431,1677999577,1677999663,1677999797,1678000193,1678000305,1678000390,1678000456,1678000480,1678000557,1678000600,1678000653,1678000656,1678000773,1678000864,1678000882,1678000942,1678001059,1678001111,1678001114,1678001181,1678001192,1678001357,1678001367,1678001524,1678001645,1678001729,1678001767,1678001772,1678002240,1678002265,1678002344,1678002407,1678002442,1678002589,1678002596,1678002728,1678002754,1678002756,1678002969,1678003141,1678003541,1678003615,1678003644,1678003667,1678003923,1678003950,1678004106,1678004144,1678004199,1678004232,1678004566,1678004569,1678004580,1678004753,1678005027,1678005029,1678005044,1678005082,1678005127,1678005206,1678005251,1678005353,1678005405,1678005462,1678005483,1678005591,1678005684,1678006314,1678006369,1678006411,1678006453,1678006494,1678006500,1678006546,1678006556,1678006588,1678006595,1678006599,1678006630,1678006632,1678006751,1678006908,1678006930,1678007078,1678007138,1678007208,1678007486,1678007590,1678008032,1678008402,1678008497,1678008587,1678008668,1678008674,1678008726,1678008767,1678009275,1678009286,1678009462,1678009492,1678009503,1678009607,1678009709,1678009730,1678009748,1678009817,1678010016,1678010065,1678010207,1678010514,1678010598,1678010636,1678010681,1678010899,1678010934,1678010982,1678010988,1678011049,1678011100,1678011126,1678011215,1678011250,1678011272,1678011296,1678011323,1678011403,1678011450,1678011509,1678011639,1678011697,1678011755,1678011818,1678011874,1678012029,1678012036,1678012256,1678012266,1678012321,1678012465,1678012538,1678012643,1678012793,1678012798,1678012915,1678012955,1678012965,1678013175,1678013464,1678013487,1678013489,1678013513,1678013627,1678013814,1678013856,1678013872,1678013921,1678013929,1678013982,1678014093,1678014299,1678014301,1678014456,1678014563,1678014613,1678014686,1678014816,1678014853,1678014884,1678015083,1678015277,1678015283,1678015374,1678015411,1678015417,1678015419,1678015481,1678015878,1678016004,1678016039,1678016102,1678016129,1678016262,1678016431,1678016502,1678016673,1678016714,1678016745,1678016889,1678016980,1678016985,1678017317,1678017344,1678017424,1678017576,1678017590,1678017728,1678017750,1678017783,1678017991,1678018354,1678018466,1678018617,1678018948,1678019150,1678019337,1678019360,1678019367,1678019396,1678019621,1678019667,1678019882,1678020153,1678020163,1678020278,1678020377,1678020448,1678020469,1678020512,1678020669,1678020752,1678020763,1678021091,1678021137,1678021142,1678021204,1678021394,1678021405,1678021429,1678021527,1678021554,1678021640,1678021652,1678021713,1678021758,1678021786,1678021866,1678022040,1678022105,1678022113,1678022119,1678022522,1678022621,1678022688,1678022689,1678022692,1678022710,1678022874,1678022897,1678022906,1678022910,1678022913,1678023001,1678023016,1678023023,1678023130,1678023388,1678023475,1678023560,1678023605,1678023606,1678023676,1678023726,1678023736,1678023825,1678023893,1678023990,1678023997,1678024147,1678024365,1678024443,1678024508,1678024520,1678024521,1678024600,1678024621,1678024629,1678024831,1678024846,1678024990,1678025099,1678025101,1678025314,1678025428,1678025472,1678025739,1678026056,1678026067,1678026178,1678026189,1678026291,1678026315,1678026330,1678026374,1678026396,1678026486,1678026535,1678026562,1678026577,1678026621,1678026895,1678026922,1678027192,1678027197,1678027323,1678027460,1678027464,1678027485,1678027554,1678027622,1678027654,1678027658,1678027682,1678027685,1678027814,1678027848,1678027850,1678027874,1678027882,1678027893,1678027931,1678027951,1678028019,1678028380,1678028485,1678028504,1678028631,1678028647,1678028782,1678028816,1678028889,1678028976,1678029011,1678029027,1678029174,1678029180,1678029316,1678029469,1678029538,1678029626,1678029643,1678029777,1678029815,1678029897,1678029931,1678030308,1678030340,1678030367,1678030387,1678030471,1678030614,1678030954,1678031143,1678031190,1678031191,1678031201,1678031384,1678031530,1678031560,1678031564,1678031597,1678031602,1678031621,1678031748,1678032042,1678032057,1678032103,1678032422,1678032484,1678032872,1678032903,1678032906,1678032958,1678033036,1678033062,1678033126,1678033201,1678033215,1678033225,1678033227,1678033243,1678033262,1678033309,1678033348,1678033444,1678033464,1678033490,1678033582,1678033692,1678033939,1678033954,1678033971,1678034107,1678034141,1678034183,1678034225,1678034286,1678034476,1678034520,1678034635,1678034705,1678034765,1678034908,1678034910,1678034935,1678035141,1678035180,1678035286,1678035417,1678035499,1678035634,1678035724,1678035820,1678036148,1678036227,1678036369,1678036475,1678036493,1678036596,1678036600,1678036777,1678036785,1678036798,1678036800,1678036810,1678036824,1678036911,1678036924,1678037100,1678037104,1678037142,1678037160,1678037259,1678037312,1678037386,1678037558,1678037559,1678037630,1678037715,1678037972,1678038147,1678038390,1678038546,1678038559,1678038652,1678038723,1678038789,1678038829,1678039320,1678039322,1678039424,1678039495,1678039519,1678039548,1678039555,1678039757,1678039779,1678039816,1678039871,1678039929,1678039953,1678040118,1678040137,1678040377,1678040719,1678040759,1678040785,1678040937,1678040972,1678040990,1678041107,1678041154,1678041453,1678041496,1678041559,1678041631,1678041707,1678041920,1678042046,1678042137,1678042236,1678042242,1678042317,1678042502,1678042534,1678042546,1678042638,1678042729,1678042765,1678042827,1678042904,1678042981,1678043028,1678043102,1678043129,1678043130,1678043248,1678043257,1678043658,1678043663,1678043725,1678043741,1678043792,1678043829,1678043979,1678044118,1678044153,1678044260,1678044358,1678044453,1678044679,1678044807,1678044808,1678044891,1678045031,1678045035,1678045042,1678045179,1678045377,1678045410,1678045712,1678045811,1678045844,1678045850,1678045930,1678046057,1678046098,1678046157,1678046197,1678046346,1678046424,1678046445,1678046474,1678046558,1678046668,1678047242,1678047301,1678047332,1678047355,1678047366,1678047383,1678047427,1678047438,1678047452,1678047505,1678047625,1678048135,1678048144,1678048186,1678048261,1678048332,1678048338,1678048457,1678048515,1678048565,1678048608,1678048630,1678048774,1678048802,1678048825,1678048834,1678048910,1678048969,1678049181,1678049189,1678049216,1678049252,1678049329,1678049466,1678049550,1678049673,1678049812,1678049948,1678049976,1678050005,1678050197,1678050198,1678050214,1678050538,1678050603,1678050604,1678050769,1678050946,1678051349,1678051505,1678051552,1678051650,1678051698,1678051785,1678051797,1678051927,1678052073,1678052194,1678052409,1678052515,1678052583,1678052698,1678052711,1678052751,1678052764,1678052765,1678052770,1678052949,1678053126,1678053282,1678053638,1678053696,1678053856,1678053938,1678054031,1678054102,1678054148,1678054151,1678054382,1678054641,1678054711,1678054843,1678054936,1678055072,1678055087,1678055141,1678055175,1678055189,1678055231,1678055263,1678055271,1678055296,1678055308,1678055579,1678055634,1678055702,1678055720,1678056126,1678056233,1678056238,1678056311,1678056415,1678056417,1678056423,1678056520,1678056760,1678056807,1678056844,1678056867,1678057058,1678057093,1678057105,1678057159,1678057325,1678057385,1678057431,1678057657,1678057821,1678058110,1678058149,1678058190,1678058433,1678058489,1678058495,1678058624,1678058629,1678058682,1678058685,1678058697,1678058893,1678058906,1678058948,1678058949,1678059038,1678059052,1678059079,1678059081,1678059234,1678059397,1678059398,1678059422,1678059439,1678059515,1678059532,1678059547,1678059567,1678059574,1678059598,1678059758,1678059894,1678060117,1678060203,1678060226,1678060483,1678060500,1678060678,1678060765,1678060899,1678060957,1678060980,1678061022,1678061024,1678061069,1678061457,1678061671,1678061681,1678061713,1678061922,1678061929,1678062055,1678062327,1678062466,1678062483,1678062535,1678062615,1678062641,1678062808,1678062828,1678062844,1678062914,1678062938,1678062940,1678063037,1678063069,1678063072,1678063082,1678063086,1678063111,1678063171,1678063209,1678063234,1678063299,1678063300,1678063354,1678063552,1678063592,1678063643,1678063735,1678063745,1678063768,1678063772,1678063921,1678063971,1678064095,1678064204,1678064732,1678064952,1678064955,1678065181,1678065280,1678065301,1678065355,1678065486}


-- For in script debugging of values
local logtable = {}
 
local function logit(msg)
  logtable[#logtable+1] = msg
end

-- For generating and manipulating timebuckets
local function get_timebucket_from_timestamp(unix_time)
  local day_count, year, days, month = function(yr) return (yr % 4 == 0 and (yr % 100 ~= 0 or yr % 400 == 0)) and 366 or 365 end, 1970, math.ceil(unix_time/86400)

  while days >= day_count(year) do
      days = days - day_count(year) year = year + 1
  end
  local tab_overflow = function(seed, table) for i = 1, #table do if seed - table[i] <= 0 then return i, seed end seed = seed - table[i] end end
  month, days = tab_overflow(days, {31,(day_count(year) == 366 and 29 or 28),31,30,31,30,31,31,30,31,30,31})
  local hours, minutes, seconds = math.floor(unix_time / 3600 % 24), math.floor(unix_time / 60 % 60), math.floor(unix_time % 60)
  local period = hours > 12 and "pm" or "am"
  -- hours = hours > 12 and hours - 12 or hours == 0 and 12 or hours
  return string.format("%04d-%02d-%02d-%02d", year, month, days, hours, minutes, seconds, period)
end


-- Redis test setup - delete all existing DB
redis.call('flushdb')

-- Interior of this for loop is what should go into wafris_core.lua
for i = 1, #(ipArray) do

  -- Configuration
  local max_requests = 100000
  local max_requests_per_ip = 5

  -- Setup
  local ip = ipArray[i]
  local timestamp = timestampArray[i]

  -- STREAMS
  -- For: Relationship of IP to time of Request (Stream)
  -- TODO: in production must replace timestamp with '*'
  local request_id = redis.call('XADD', 'ip-requests-stream', 'MAXLEN', '~', max_requests, timestamp, 'ip', ip )

  -- For: Looking up Requests an IP has made (Stream) / time of request
  local ip_stream_key = "ip-stream:" .. ip
  local ip_stream_id = redis.call('XADD', ip_stream_key, 'MAXLEN', '~', max_requests_per_ip, '*', 'request_id', request_id)

  -- TIMEBUCKETS
  -- TODO: no customization of timebuckets is implemented so it's hardcoded to hours
  local current_timebucket = get_timebucket_from_timestamp(timestamp)

  -- For: Precalc of Number of Requests (Key)
  local requests_count_key = "requests-count:" .. current_timebucket
  redis.call('INCR', requests_count_key)

  -- For: Precalc of Number of Requests from an IP (Key)
  local ips_count_bucket_key = "ips-count:" .. ip .. ":" .. current_timebucket
  redis.call('INCR', ips_count_bucket_key)

  -- For: Precalc of Number of Unique IPs making Requests (HLL)
  local ips_count_hll_key = "unique-ips:" .. current_timebucket
  redis.call('PFADD', ips_count_hll_key, ip)

  -- For: Leaderboard of IPs with Request count as score
  local ip_leaderboard_sset_key = "ip-leader-sset:" .. current_timebucket
  redis.call('ZINCRBY', ip_leaderboard_sset_key, 1, ip)

  logit(ip_stream_key)

end

-- Only for testing script
return logtable